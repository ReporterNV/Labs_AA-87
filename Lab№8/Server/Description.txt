Переписал так чтоб нормально обрабатывал.
Ошибка, скорей всего, возникает из-за того, что символ окончания строки (0x0D 0x0A) один из которых преобразуется в " ". Он у меня в счёт не идёт(те -1), но заменяется при выводе в пробел.